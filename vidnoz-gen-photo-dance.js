let pornDetectthreshold,videoHot,videoData,dance_id,photo,task_Id,progress,danceMusic,danceMusic_num,danceMotion,danceMotion_num,photo_key=null,randomIndex=0,step2Img={url:null,blob:null},step3Img={url:null,blob:null},playCount=0,isShowToolbar={local:!1,recent:!1},limitNub=5,musicList=[],resData={},self_img=!1,self_motion=!1,uploadData={action:"clothes_changer",param:{photo_key:"",clothes_key:"",is_checked_pants:"upper_body"}},progressTextClip=$(".loading-spinner > p"),faceApi=!1,libVd=$LIB();$creditBadge=$("credit-badge");var BASE_API=location.host.includes("www.vidnoz.com")?"https://api.vidnoz.com/":"https://api-test.vidnoz.com/";function uploadEvent(){gtag("event","upload_aidance_img"),$(".upLoad__box__tips").css({display:"flex"}),$("#upload-content-clip").click()}function openShare(e){const t=e.detail.value,a=t.asset[0].key,i=t.cover_key,n=$("#shareDialogEl")[0];console.log(e,"eee"),n.changeTips({title:PAGE_LAN.share,content:PAGE_LAN.shareContent}),n.showShare({url:2==t.type?t.cover_url:"",imageKey:i,videoKey:1==t.type?a:"",poster:1==t.type?t.cover_url:"",text:PAGE_LAN.shareText,title:PAGE_LAN.share,task_id:t.task_id,backParams:function(e){return{id:t.task_id,key:e}},GenType:t.type})}function handelShareEvent(){window.addEventListener("shareEvent",(function(e){openShare(e)}))}function handelDownLoadEvent(){window.addEventListener("downLoadEvent",(async function(e){genAuth.isLogin?await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key}):(gtag("event","alert_babygenerator_dwlogin"),genAuth.handleLogin({fn:()=>{window.dispatchEvent(new CustomEvent("updateRecentCom")),initCreditBadge()}}))}))}function getObjectURL(e){let t=null;return null!=window.createObjectURL?t=window.createObjectURL(e):null!=window.URL?t=window.URL.createObjectURL(e):null!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}function isMobileDevice(){const e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}function isOverImage(e){return new Promise(((t,a)=>{const i=e[0].size;isMobile()?t(i>=104857600):t(!1)}))}handelShareEvent(),setRecentComponent(),$(".download-btn").click((async()=>{genAuth.isLogin?(gtag("event","click_aidance_download"),2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:resData.merge_key})):(gtag("event","showlogin_aidance_download"),genAuth.handleLogin({fn:async()=>{2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:resData.merge_key})}}))})),$("#targetUpload").on("click",(async function(){gtag("event","upload_aidance_img"),$(".upLoad__box__tips").css({display:"flex"})}));class progressHandle{constructor(e){const{time:t,main:a}=e;this.time=t,this.main=a,this.progress_20=0,this.progress_50=0,this.progress_90=0,this.init()}stop(){this.progress_20=0,this.progress_50=0,this.progress_90=0,this.time=0,clearInterval(this.timer),this.main.text(PAGE_LAN.ttv_btn_loading+"...")}init(){this.timer=setInterval((()=>{switch(this.time++,98===this.time&&(this.time=98,clearInterval(this.timer)),!0){case this.time<20:this.main.text(PAGE_LAN.ttv_btn_loading+"... "+this.time+"%");break;case this.time>20:this.main.text(PAGE_LAN.Analyzing+"... "+this.time+"%");break;case this.time>20&&this.time<40:this.main.text(PAGE_LAN.Synthesizing+"... "+this.time+"%");break;case this.time>40&&this.time<=98:this.main.text(PAGE_LAN.Animating+"... "+this.time+"%")}}),1e3)}}function getCreationData(){window.addEventListener("trainTask",(async e=>{isShowToolbar.recent=!0,console.log(isShowToolbar.local,"isShowToolbar.local"),isShowToolbar.recent&&isShowToolbar.local&&task_Id===e.detail.value.task_id&&(danceEndLoading(),2==genAuth.data.credit_info.is_credit_subscription?$(".no-water-btn").css({display:"flex"}):$(".no-water-btn").hide())}))}function isImage(e){const t=new FileReader;return t.readAsDataURL(e),t.onload=function(e){const t=e.target.result;(new Image).src=t},["jpeg","jpg","png","webp"].includes(`${e.type.split("/")[1]}`)?{isImgType:!0,imgSize:""}:{isImgType:!1,imgSize:""}}function getConfig(){return new Promise((function(e,t){$LIB().get(`${BASE_API}api/site/app-config`,{origin:"web"}).then((t=>{const a=t?.data?.porn_detect_threshold,i=t?.data?.sensitive_word_interception_ratio;void 0===a&&null===a||(pornDetectthreshold=a),void 0===i&&null===i||(sensitiveWordRatio=i),isGetFace=!0,e(!0)}))}))}function handelImageEvent(e){return new Promise(((t,a)=>{const i=new FileReader;i.readAsDataURL(e[0]),i.onload=function(e){const a=e.target.result,i=new Image;i.src=a,i.onload=async function(){i.width,i.height;t()}}}))}function base64ToBlobUrl(e){const t=e.split(";base64,"),a=t[0].split(":")[1],i=window.atob(t[1]),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const o=new Blob([n],{type:a});return URL.createObjectURL(o)}function getFirstFrame(e,t){return new Promise((async(a,i)=>{const n=document.createElement("video");let o;n.muted=!0,n.crossOrigin="anonymous",o=e?URL.createObjectURL(e):t,await new Promise((e=>setTimeout(e,1e3))),n.setAttribute("playsinline",""),n.addEventListener("loadedmetadata",(()=>{n.currentTime=.001})),console.log(o,123),n.src=o,n.addEventListener("seeked",(()=>{try{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=n.videoWidth,e.height=n.videoHeight,t.drawImage(n,0,0,e.width,e.height);const i=e.toDataURL("image/png");URL.revokeObjectURL(o),a(i)}catch(e){i(e)}})),n.addEventListener("error",(e=>{URL.revokeObjectURL(o),i(new Error("视频加载失败: "+e.message))}))}))}function isVideoFile(e){const t=e.slice(e.lastIndexOf(".")).toLowerCase();return[".mp4",".m4v",".mov",".webm"].includes(t)}$(".upLoad__box__tips_content .close").click((function(){$(".upLoad__box__tips").hide()})),$(".upLoad__motion_tips_content .close").click((function(){$(".upLoad__motion_tips").hide()})),$(".upLoad__box__tips_content .upload_btn").click((function(){gtag("event","up_aidance_img"),$("#targetFileInput").click()})),$(".upLoad__motion_tips_content .upload_btn").click((function(){gtag("event","up_aidance_motion"),$("#motionFileInput").click()})),$(".select-container").on("click",(function(e){if(e.stopPropagation(),$(this).toggleClass("active"),isMobile()){let e;const t=genDialog({content:`<div class="mob-filter-select">\n                        <div class="select-title">\n                            <div class="title">Select a background music</div>\n                            <i class="close-icon"></i>\n                        </div>         \n                        <div class="select-container">\n                            ${musicList.map(((e,t)=>`<div class="select-item ${t===danceMusic_num-1?"active":""}" data-url="${e.url}" data-index="${t+1}" data-key="${e.key}">\n                             <i class="check-icon"></i>${e.name}<i class="play-icon"></i>\n                            <i class="item-icon"></i></div>`)).join("")}\n                             <div class="select-item" data-val="upper_body"><i class="check-icon"></i>No BGM</div>\n                        </div>          \n                        <div class="btn-area">\n                           <div class="success-btn">Confirm</div>\n                         </div>   \n                  </div>`,isPopup:!0});t.open(),t.$dialog.on("click",".close-icon",(e=>{t.close()})),t.$dialog.on("click",".select-item",(t=>{$(".select-item").removeClass("active"),$(t.target).addClass("active"),danceMusic=$(t.target).attr("data-key"),danceMusic_num=$(t.target).attr("data-index"),e=$(t.target).text().trim()})),t.$dialog.on("click",".play-icon",(e=>{e.stopPropagation(),$(e.target).hasClass("active")?($(e.target).removeClass("active"),$(".select-audio").attr("src",$(e.target).parent().attr("data-url"))[0].pause(),$(e.target).parent().find(".item-icon").removeClass("active")):($(".play-icon").removeClass("active"),$(".item-icon").removeClass("active"),$(e.target).addClass("active"),$(e.target).parent().find(".item-icon").addClass("active"),$(".select-audio").attr("src",$(e.target).parent().attr("data-url"))[0].play())})),t.$dialog.on("click",".success-btn",(a=>{$(".select-container .select-text").text(e),t.close(),$(".select-audio").attr("src",$(a.target).parent().attr("data-url"))[0].pause()}))}else $(".select-body").toggle(),$(".select-icon").toggleClass("reverse")})),$(document).on("click",(function(){$(".select-body").hide(),$(".select-icon").removeClass("reverse")})),$(".select-body").on("click",(function(e){e.stopPropagation()})),$(".select-item").on("click",(function(e){uploadData.param.is_checked_pants=$(this).attr("val"),gtag("event","select_clotheschanger_"+$(this).text().replace(/\s+/g,"").toLowerCase()),$(".select-text").text($(this).text()),e.stopPropagation(),$(".select-body").hide(),$(".select-icon").removeClass("reverse"),$(".select-item").css("background-color",""),$(this).css("background-color","#F1EAFC")}));const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;function danceInitLoading(){$(".change-container").addClass("loading"),$(".toolbar-container").addClass("loading"),$(".generate-container").addClass("loading"),$(".generate-btn").addClass("disabled"),$(".finished-btns").hide(),$(".clip_video_container").hide(),$(".dance-banner-img").show(),$(".loading-spinner").css({display:"flex"}),$(".mid-transform-info").css({display:"flex"})}function danceEndLoading(){$(".dance-banner-img").hide(),$(".clip_video_container").show(),$(".change-container").removeClass("loading"),$(".toolbar-container").removeClass("loading"),$(".generate-container").removeClass("loading"),$(".generate-btn").removeClass("disabled"),$(".loading-spinner").hide(),$(".mid-transform-info").hide(),endPoint(),$(".finished-btns").css({display:"flex"}),$(".change-container").removeClass("init-state"),$(".my-recent-container-pc").addClass("init-state"),isMobile()&&$(".finished-btns").find("#zoomIn").hide()}function errorHandle(){$(".dance-banner-img").show(),$(".mid-transform-info").hide(),$(".loading-spinner").hide(),endPoint(),$(".change-container").removeClass("loading"),$(".toolbar-container").removeClass("loading"),$(".generate-container").removeClass("loading"),$(".generate-btn").removeClass("disabled")}function localShare(){const e=resData.merge_key,t=resData.cover_key,a=$("#shareDialogEl")[0];console.log(e,"videoKey"),console.log(t,"imageKey"),console.log(a,"shareDialogEl"),a.changeTips({title:PAGE_LAN.share,content:PAGE_LAN.shareContent}),a.showShare({url:resData.merge_url,imageKey:t,videoKey:e,poster:resData.cover_url,text:PAGE_LAN.shareText,title:PAGE_LAN.share,task_id:task_Id,backParams:function(e){return{id:task_Id,key:e}},GenType:1})}function initCreditBadge(){$creditBadge.attr("credit",genAuth.data.limit.use_credit_amount),genAuth.isLogin?genAuth.data.credit_info.credit>0||0===genAuth.data.limit.usable?$creditBadge.show():$creditBadge.hide():genAuth.data.limit.usable>0?$creditBadge.hide():$creditBadge.show()}$("#motionFileInput").on("change",(async function(e){try{const e=$("#motionFileInput").prop("files");if(0===e.length)return;$(".upload-dance-style").addClass("loading"),$(".upLoad__motion_tips").hide();const t=e[0];if(!isVideoFile(t.name))return genDialogService.failed({title:PAGE_LAN.failed,desc:isIOS?PAGE_LAN.ios_fail:PAGE_LAN.no_ios_fail}),void $(".upload-dance-style").removeClass("loading");const a=t.size;if(a>52428800)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.vide_err4}),void $(".upload-dance-style").removeClass("loading");const i=getObjectURL(t),n=document.createElement("video"),o=t.name.split(".")[0];n.muted=!0,await new Promise((e=>setTimeout(e,1e3))),$(".upload-dance-style").removeClass("loading"),n.addEventListener("loadedmetadata",(async()=>{const e=n.duration;if(parseInt(e)<5)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.video_err}),void $(".upload-dance-style").removeClass("loading");if(parseInt(e)>300)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.video_err1}),void $(".upload-dance-style").removeClass("loading");$(".dance-style-box-item").removeClass("active");const a=base64ToBlobUrl(await getFirstFrame(t));isMobile()?$(".dance-style-box").children().eq(1).before(`<div class="dance-style-box-item active"   data-index="-1" data-video="${i}">\n<img src="${a}" alt="">\n<p>${o}</p></div>`):$(".dance-style-box").children().eq(1).before(`<div class="dance-style-box-item active"    data-index="-1" data-video="${i}">\n<img src="${a}" alt="">\n<p>${o}</p>\n</div>`);let s={cover:-1,cover_url:a,key:Math.floor(1e3*Math.random()),name:o,url:i};dance_id=s.key,videoData.HOT.unshift(s),self_motion=!0,isMobile()?(console.log(123),$(".dance-style-box-item").click((function(){$(".dance-style-box-item video").remove();const e=$(this)[0],t=e.dataset.video;let a=null;a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a)),self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),dance_id=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index")}))):(document.querySelectorAll(".dance-style-box-item").forEach((e=>{const t=e.dataset.video;let a=null;e.addEventListener("mouseenter",(()=>{a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a))})),e.addEventListener("mouseleave",(()=>{a&&(a.pause(),a.remove(),a=null)}))})),$(".dance-style-box-item").click((function(){self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),dance_id=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index"),console.log(danceMotion_num,"danceMotion_num")})))})),n.src=URL.createObjectURL(t)}catch(e){console.log(e,"eee")}})),$("#targetFileInput").on("change",(async function(e){const t=$("#targetFileInput").prop("files");0!==t.length&&($(".upLoad__box__tips").hide(),$(".target-upload-btn").addClass("loading"),handelImageEvent(t).then((async()=>{if(await isOverImage(t))return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_over}),void $(".target-upload-btn").removeClass("loading");if(!isImage(t[0]).isImgType)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_img}),void $(".target-upload-btn").removeClass("loading");const a=Math.floor(100*Math.random())+1,i=getObjectURL(t[0]);let n=t[0].type.split("/")[1];try{let e=await libVd.tempUploadUrl({file_name:"vidnoz-gen-photo-dance-"+(new Date).getTime()+"."+n});if(step2Img.blob=e.data.key,200!==e.code)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.uploadError}),!1;await libVd.put(e.data.upload_url,t[0]).catch((()=>!1))}catch(e){return showError(),!1}$(".select-img-box").find(".target-img-box").removeClass("select-img"),$(".select-img-box").children().eq(2).before(`<div data-id=${a} class="target-img-box   select-img extend-upload"><img data-blob="${step2Img.blob}" src="${i}"></div>`),self_img=!0,$(".select-img-box .extend-upload").on("click",(function(){self_img=!0,gtag("event","change_aidance_image"),$(".target-img-box").removeClass("select-img"),$(this).addClass("select-img");var e=$(this).find("img").attr("data-blob");$(".dance-banner-img").attr("src",$(this).find("img").attr("src")).show(),$(".finished-btns").hide(),$(".clip_video_container").hide(),step2Img={url:e,blob:e},step2Img.blob&&$(".generate-btn").removeClass("disabled")})),i&&($(".change-container").removeClass("init-state"),$(".my-recent-container-pc").addClass("init-state"),$(".show-img-content").show(),photo_key=null,$(".generate-btn").removeClass("disabled"),$(".dance-banner-img").attr("src",i).show(),$(".finished-btns").hide(),$(".clip_video_container").hide(),e.target.value=""),$(".target-upload-btn").removeClass("loading")})))})),$("#share").click((function(){gtag("event","click_aidance_share"),localShare()})),$("#zoomIn").click((function(){gtag("event","click_aidance_zoomin"),genDialogService.zoomDialog([{url:resData.merge_url,isVideo:!0,shareFunction:()=>{gtag("event","click_aidance_share"),localShare()},downloadFunction:async()=>{gtag("event","click_aidance_download"),genAuth.isLogin?2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:resData.merge_key}):(gtag("event","showlogin_aidance_download"),genAuth.handleLogin({fn:async()=>{2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:resData.merge_key})}}))}}],0,"AI Photo Dance")}));const video=document.getElementById("recent-video"),playIcon=document.getElementById("recent-video-icon");function playVideo(){video.paused?(video.play(),$(".clip_video_container .play-icon").hide()):(video.pause(),$(".clip_video_container .play-icon").show())}function endPoint(){clearInterval(timerAClip),timerAClip=null,$(".generate-btn > p").text(PAGE_LAN.ttv_btn_success)}function starPoint(){let e=0;timerAClip=setInterval((()=>{e<3?e++:e=1;let t="";for(let a=0;a<e;a++)t+=".";$(".generate-btn > p").text(PAGE_LAN.ttv_btn_loading+" "+t)}),1e3)}async function blobUrlToFile(e,t){const a=await fetch(e),i=await a.blob();return new File([i],t||"file",{type:i.type})}async function clipCreator(){const e={avatar_key:step2Img.blob,dance_key:danceMotion,dance_num:danceMotion_num,music_key:danceMusic,music_num:danceMusic_num};progress&&progress.init();const t=await genAuth.updateCredit(),a=$creditBadge.attr("credit");if(console.log(a),2==genAuth.data.credit_info.is_credit_subscription&&0===genAuth.data.limit.usable)return gtag("event","alert_aidance_maxlimit"),progress&&progress.stop(),genDialogService.upgrade(),void(0!==Object.keys(resData).length?danceEndLoading():errorHandle());if(t<parseInt(a)&&0===genAuth.data.limit.usable)return gtag("event","alert_aidance_nocredit"),progress&&progress.stop(),genDialogService.insufficientCredits(a),void(0!==Object.keys(resData).length?danceEndLoading():errorHandle());const i=await httpClient.post(toolsHost+"/ai/tool/dance",e).catch((()=>{gtag("event","click_aidance_failed"),genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_des}),progress&&progress.stop(),errorHandle()}));task_Id=i?.data?.task_id,window.dispatchEvent(new CustomEvent("updateRecentCom")),200===i.code&&await async function e(t){const a=await httpClient.post(toolsHost+"/ai/tool/get-task",{id:t}).catch((()=>{gtag("event","click_aidance_failed"),genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_des}),progress.stop(),errorHandle()}));if(403===a.code){let e;return e=/reupload/g.test(a.message)?PAGE_LAN.failedDesc11:/nsfw/g.test(a.message)?PAGE_LAN.nsfw_dec:PAGE_LAN.faild_des,genDialogService.failed({title:PAGE_LAN.failed,desc:e}),progress.stop(),void errorHandle()}if(3006===a.code)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_des}),progress.stop(),void errorHandle();let i=a.data.status;0===i?(isShowToolbar.local=!0,gtag("event","succ_aidance_genbtn"),task_Id=a.data.id,resData=a.data.additional_data,$(".clip_video").attr("src",resData.merge_url),$(".clip_video").attr("poster",resData.cover_url),initCreditBadge(),progress.stop(),isShowToolbar.recent&&isShowToolbar.local&&(danceEndLoading(),2==genAuth.data.credit_info.is_credit_subscription?$(".no-water-btn").css({display:"flex"}):$(".no-water-btn").hide()),await genAuth.updateCredit()):-2!==i&&-1!==i||(progress||(progress=new progressHandle({time:0,main:progressTextClip})),setTimeout((async()=>{await e(t)}),3e3))}(i.data.task_id),3002===i.code&&(genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.faild_des}),errorHandle()),3008===i.code&&(gtag("event","alert_aidance_nocredit"),genDialogService.insufficientCredits(a),0!==Object.keys(resData).length?danceEndLoading():errorHandle()),3022===i.code&&(gtag("event","show_aidance_storagewin"),genDialogService.upgrade("unlimited"),0!==Object.keys(resData).length?danceEndLoading():errorHandle()),3012===i.code&&(gtag("event","alert_aidance_maxlimit"),genDialogService.upgrade(),0!==Object.keys(resData).length?danceEndLoading():errorHandle())}function jumpAppAddressEvent(){isMobile()?window.open(`${mobProductLink}/library?openTab=magicanimate`):window.open(`${aiUrl}/asset/index.html?openTab=magicanimate`)}async function getDanceList(){const e=await httpClient.get(toolsHost+"/ai/gen/dance-options"),t=e?.data?.photo.slice(0,14)||[],a=e.data.bgm;musicList=a,videoData=e?.data?.motion||[];let i="";i="",a.forEach(((e,t)=>{i+=`\n          <div class="select-drop-item ${0===t?"active-hover":""}" data-key="${e.key}" data-index="${t+1}" data-url="${e.url}">\n               <i class="active-icon"></i>\n               <p>${e.name}</p>\n               <i class="play-icon"></i>\n               <i class="item-icon"></i>\n         </div>\n        `})),i+='<div class="select-drop-item" data-key="" data-index="" data-url="">\n               <i class="active-icon"></i>\n               <p>No BGM</p>      \n               <i class="blank"></i>\n               <i class="blank"></i>   \n         </div>',$(".select-container .select-text").text(a[0].name),$(".select-body").html(i),danceMusic=a[0].key,danceMusic_num=1,danceMotion=videoData.HOT[0]?.key,danceMotion_num=1;for(let e of t){var n=$("<div>").addClass("target-img-box").attr("data-blob",e.key),o=$("<img>").attr("src",e.url);n.append(o),n.insertAfter("#targetUpload"),n.on("click",(function(){gtag("event","change_aidance_image"),self_img=!1,$(".target-img-box").removeClass("select-img"),$(this).addClass("select-img");var t=$(this).attr("data-blob");$(".dance-banner-img").attr("src",e.url).show(),$(".finished-btns").hide(),$(".clip_video_container").hide(),step2Img={url:t,blob:t},step2Img.blob&&$(".generate-btn").removeClass("disabled"),$(".change-container").removeClass("init-state"),$(".my-recent-container-pc").addClass("init-state")}))}let s="";Reflect.ownKeys(videoData).forEach(((e,t)=>{s+=`<div data-tag="${e}" class="per-tag ${0===t?"active":""}">${e}</div>`})),$(".dance-style-toolbar").html(s),renderTagClickEvent(Reflect.ownKeys(videoData)[0]),$(".per-tag").click((function(){gtag("event","change_aidance_motioncate"),$(".per-tag").removeClass("active"),$(this).addClass("active"),renderTagClickEvent($(this).attr("data-tag")),"HOT"==$(this).attr("data-tag")?$(".upload-dance-style").show():$(".upload-dance-style").hide()})),$(".select-drop-item").click((function(e){$(".select-drop-item").removeClass("active-hover"),$(this).addClass("active-hover"),$(this).attr("data-key");const t=$(this).find("p").text();danceMusic=$(this).attr("data-key"),danceMusic_num=$(this).attr("data-index"),$(".select-drop-item").removeClass("active"),$(".select-drop-item").removeClass("active-play"),$(".select-drop-item .item-icon").removeClass("active"),$(".select-drop-warp").hide(),$(".dance-select-box .arrow").removeClass("drop"),$(".select-container .select-text").text(t),gtag("event","change_aidance_bgm"),$(".select-audio")[0].pause()})),$(".select-drop-item .item-icon").click((function(e){e.stopPropagation(),$(this).hasClass("active")?($(this).parent().removeClass("active"),$(this).parent().removeClass("active-play"),$(this).removeClass("active"),$(".select-audio").attr("src",$(this).parent().attr("data-url"))[0].pause()):($(".select-drop-item .item-icon").removeClass("active"),$(".select-drop-item").removeClass("active"),$(".select-drop-item").removeClass("active-play"),$(this).addClass("active"),$(this).parent().addClass("active"),$(this).parent().addClass("active-play"),$(this).parent().find(".play-icon").show(),$(".select-audio").attr("src",$(this).parent().attr("data-url"))[0].play())})),setLocation()}function renderTagClickEvent(e){let t='<div class="upload-dance-style"><i></i><p>Upload</p></div>';videoData[e].forEach(((e,a)=>{t+=`\n        <div class="dance-style-box-item ${dance_id?dance_id==e.key?"active":"":0===a?"active":""}"  data-key="${e.key}"  data-index="${-1==e.cover?-1:a+1}" data-video="${e.url}">\n            <img\n           src="${e.cover_url}"\n             />\n            <p>${e.name}</p>\n        </div>\n        `})),$(".dance-style-box").html(t),$(".upload-dance-style").click((function(){$(".upLoad__motion_tips").css({display:"flex"})})),isMobile()?$(".dance-style-box-item").click((function(){$(".dance-style-box-item video").remove();const e=$(this)[0],t=e.dataset.video;let a=null;a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a)),self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),dance_id=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index")})):(document.querySelectorAll(".dance-style-box-item").forEach((e=>{const t=e.dataset.video;let a=null;e.addEventListener("mouseenter",(()=>{a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a))})),e.addEventListener("mouseleave",(()=>{a&&(a.pause(),a.remove(),a=null)}))})),$(".dance-style-box-item").click((function(){self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),dance_id=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index"),console.log(danceMotion_num,"danceMotion_num")})))}function getQueryParams(){const e=new URLSearchParams(window.location.search),t={};for(const[a,i]of e.entries())t[a]=i;return t}function saveQueryParamsToStorage(){const e=getQueryParams();sessionStorage.setItem("queryParams",JSON.stringify(e))}function clearQueryParamsFromURL(){const e=new URL(window.location);e.search="",window.history.replaceState({},"",e.toString())}function setLocation(){const e=new URL(window.location.href),t=new URLSearchParams(e.search);t.get("id")&&httpClient.get(toolsHost+"/ai/gen/remix-param?id="+t.get("id")).then((async e=>{if(200==e.code&&e.data){if($(".select-drop-item").removeClass("active-hover"),$(".dance-style-box-item").removeClass("active"),$(`.select-drop-item[data-key="${e.data.param.music_key}"]`).length){const t=musicList.find((t=>t.key===e.data.param.music_key)).name;$(`.select-drop-item[data-key="${e.data.param.music_key}"]`).addClass("active-hover"),$(".select-container .select-text").text(t)}else $('.select-drop-item[data-index="1"]').addClass("active-hover");if($(`.dance-style-box-item[data-key="${e.data.param.dance_key}"]`).length)$(`.dance-style-box-item[data-key="${e.data.param.dance_key}"]`).addClass("active");else{let t=`\n        <div class="dance-style-box-item active"  data-key="${e.data.param.dance_key}"  data-index="0" data-video="${e.data.param.dance_url}">\n            <video style="position: unset"\n                   src="${e.data.param.dance_url}" muted loop\n             ></video>\n            <p>Dance</p>\n        </div>\n        `;const a=base64ToBlobUrl(await getFirstFrame(null,e.data.param.dance_url));$(".upload-dance-style").after(t);let i={cover:-1,cover_url:a,key:e.data.param.dance_key,name:"Dance",url:e.data.param.dance_url};dance_id=i.key,videoData.HOT.unshift(i),isMobile()?$(".dance-style-box-item").click((function(){$(".dance-style-box-item video").remove();const e=$(this)[0],t=e.dataset.video;let a=null;a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a)),self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index")})):(document.querySelectorAll(".dance-style-box-item").forEach((e=>{const t=e.dataset.video;let a=null;e.addEventListener("mouseenter",(()=>{a||(a=document.createElement("video"),a.src=t,a.autoplay=!0,a.muted=!0,a.loop=!0,e.appendChild(a))})),e.addEventListener("mouseleave",(()=>{a&&(a.pause(),a.remove(),a=null)}))})),$(".dance-style-box-item").click((function(){self_motion=!1,$(".dance-style-box-item").removeClass("active"),$(this).addClass("active"),gtag("event","change_aidance_motion"),danceMotion=$(this).attr("data-key"),danceMotion_num=$(this).attr("data-index"),console.log(danceMotion_num,"danceMotion_num")})))}danceMusic=e.data.param.music_key,danceMusic_num=1,danceMotion=e.data.param.dance_key,danceMotion_num=1}else genDialogService.failed()})).catch((e=>{console.error("remix error=>",e)}))}function showError(e,t){let a;a=1==limitNub?"time":"times";3016===e&&gtag("event","alert_clotheschanger_maxlimit");let i={3016:{title:PAGE_LAN.LimitMaxTitle,content:getLimitText(limitNub)}},n=i[e]?i[e].content:PAGE_LAN.normalError,o=i[e]?i[e].title:PAGE_LAN.failed,s=[{msg:PAGE_LAN.noPerson,content:PAGE_LAN.noPersonDetected}];if(t)for(let e of s)if(t.includes(e.msg)){n=e.content;break}ToolTip({type:"error",title:o,content:n,btn:"OK"})}async function openDownLoadFile(e){if(0!==e.detail.value.asset?.length)if(e.detail.value.asset?.length>1){e.detail.value.asset.map((t=>({key:t.key,name:e.detail.value.name})));2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key})}else genAuth.isLogin?2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key}):genAuth.handleLogin({fn:async()=>{2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key})}})}function setRecentComponent(){$(".recent-inner").html(`<recent-component data-title='My recents' viewMore='' params='${JSON.stringify({action_type:4})}'  parentClassName=".dancer-inner-wrapper"/>`),window.addEventListener("shareEvent",(e=>{gtag("event","click_aidance_recentshare"),openShare(e)})),window.addEventListener("previewEvent",(async e=>{gtag("event","click_aidance_recentzoomin");const t=e.detail.value.asset;if(!t||0===t.length)return;const a=t.map((async t=>({url:(await httpClient.post(toolsHost+"/ai/source/get-access-url",{key:t.key})).data.url,isVideo:1==e.detail.value.type,shareFunction:()=>{gtag("event","click_aidance_recentshare"),openShare(e)},downloadFunction:()=>{gtag("event","click_aidance_recentdownload"),openDownLoadFile(e)}})));genDialogService.zoomDialog(await Promise.all(a),0,e.detail.value.name)})),window.addEventListener("downLoadEvent",(async e=>{genAuth.isLogin?(gtag("event","click_aidance_recentdownload"),2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key})):(gtag("event","showlogin_aidance_recentdownload"),genAuth.handleLogin({fn:async()=>{2==genAuth.data.credit_info.is_credit_subscription?jumpAppAddressEvent():await genDownloader.download({name:"AI_Photo_Dance.mp4",key:e.detail.value.asset[0].key})}}))}))}video.addEventListener("ended",(function(){$("#recent-video-icon").show()})),video.addEventListener("click",(function(){playVideo()})),playIcon.addEventListener("click",(function(){playVideo()})),$(".generate-btn").click((async function(){danceInitLoading(),starPoint();const e=$('.dance-style-box-item[class*="active"]');e.find("video");if("-1"==$(e).attr("data-index")){const t=await blobUrlToFile(e.attr("data-video"));let a=t.type.split("/")[1];try{let e=await libVd.tempUploadUrl({file_name:"vidnoz-gen-photo-dance-"+(new Date).getTime()+"."+a});if(step3Img.blob=e.data.key,200!==e.code)return genDialogService.failed({title:PAGE_LAN.failed,desc:PAGE_LAN.uploadError}),!1;await libVd.put(e.data.upload_url,t).catch((()=>!1)),danceMotion=step3Img.blob,danceMotion_num=-1}catch(e){return showError(),!1}}gtag("event","click_aidance_genbtn"),self_img&&gtag("event","click_aidance_genbtnwithimg"),self_motion&&gtag("event","click_aidance_genbtnwithmotion");const t=await genAuth.updateCredit(),a=$creditBadge.attr("credit");if(initCreditBadge(),genAuth.isLogin){if(2==genAuth.data.credit_info.is_credit_subscription&&0===genAuth.data.limit.usable)return gtag("event","alert_aidance_maxlimit"),genDialogService.upgrade(),void errorHandle();if(t<parseInt(a)&&0===genAuth.data.limit.usable)return gtag("event","alert_aidance_nocredit"),genDialogService.insufficientCredits(a),void errorHandle()}await clipCreator()})),$(".no-water-btn").click((function(){gtag("event","click_aidance_nowater"),genDialogService.upgrade("watermark")})),genAuth.on("loginStateChange",(async({isLoggedIn:e,userInfo:t})=>{window.dispatchEvent(new CustomEvent("updateRecentCom")),initCreditBadge()})),$(".select-audio").on("ended",(function(){$(".select-drop-item").removeClass("active-play"),$(".select-drop-item").find(".item-icon").removeClass("active"),$(".select-container").find(".play-icon").removeClass("active"),$(".select-container").find(".item-icon").removeClass("active")})),window.addEventListener("unload",(function(){sessionStorage.removeItem("refreshCount")})),window.onload=function(){let e=sessionStorage.getItem("refreshCount");e?1==e?(clearQueryParamsFromURL(),sessionStorage.removeItem("refreshCount")):sessionStorage.removeItem("refreshCount"):(sessionStorage.setItem("refreshCount",1),saveQueryParamsToStorage())};let seo_useCasesBox_img=Array.from($(".seo_useCasesBox_img"));var seo_useCasesBox_swiper1=new Swiper(".seo_useCasesBox_swiper1",{slidesPerView:1,pagination:{el:".seo_useCasesBox_swiper1 .activeIcon",clickable:!0},autoplay:{delay:8e3,disableOnInteraction:!1},on:{slideChange:function(){seo_useCasesBox_img.forEach(((e,t)=>{t!==seo_useCasesBox_swiper1.activeIndex||e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}))}}});if(isMobile())var companies_swiper_m=new Swiper(".seo_useCasesBox_swiper1_m",{slidesPerView:1,centeredSlides:!0,speed:800,autoplay:{delay:8e3,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0}});function clearDemoHoverStyle(){demosItems.forEach((e=>{e.classList.remove("demoHover")})),demosItems_m.forEach((e=>{e.classList.remove("demoHover")}))}mackButtons=document.querySelectorAll(".mackButton"),mackButtons.forEach((e=>{e.onclick=()=>{e.className.includes("magicAnimate_best")?gtag("event","danceupclick_aidance_what"):e.className.includes("animationDemos")?gtag("event","danceupclick_aidance_demo"):e.className.includes("highlightsPhoto")?gtag("event","danceupclick_aidance_feature"):e.className.includes("whyDance")?gtag("event","danceupclick_aidance_benefit"):e.className.includes("useCasesButton")?gtag("event","danceupclick_aidance_usecase"):e.className.includes("howDance")?gtag("event","danceupclick_aidance_step"):e.className.includes("bottomBanner")&&gtag("event","danceupclick_aidance_bottom"),window.scrollTo({top:0,left:0,behavior:"smooth"})}})),demosItems=document.querySelectorAll(".seo_animationDemosItemBox .demo"),demosItems_m=document.querySelectorAll(".seo_animationDemosItemBox_m .demo"),videoList=document.querySelectorAll(".seo_animationDemosItemBox .demo video"),videoList_m=document.querySelectorAll(".seo_animationDemosItemBox_m .demo video"),demosItems.forEach((e=>{e.addEventListener("mouseenter",(t=>{const a=e.querySelector(".playIocn"),i=e.querySelector("video");this.clearDemoHoverStyle(),e.classList.add("demoHover");a.onclick=t=>{t.stopPropagation(),videoList.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),i.style.display="block",i.play(),a.style.display="none",e.classList.add("play")},i.addEventListener("ended",(function(){const t=e.querySelector("video"),a=e.querySelector(".playIocn");e.classList.remove("play"),a.style.display="block",t.pause(),t.currentTime=0}))})),e.addEventListener("mouseleave",(t=>{e.classList.remove("demoHover"),demosItems[1].classList.add("demoHover")})),e.addEventListener("click",(t=>{const a=e.querySelector("video"),i=e.querySelector(".playIocn");e.classList.contains("play")?(e.classList.remove("play"),i.style.display="block",a.pause(),a.currentTime=0):(t.stopPropagation(),videoList.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),a.style.display="block",a.play(),i.style.display="none",e.classList.add("play"))}))})),demosItems_m.forEach((e=>{const t=e.querySelector(".playIocn"),a=e.querySelector("video");t.onclick=i=>{i.stopPropagation(),videoList_m.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),a.style.display="block",a.play(),t.style.display="none",e.classList.add("play")},a.addEventListener("ended",(function(){const t=e.querySelector("video"),a=e.querySelector(".playIocn");e.classList.remove("play"),a.style.display="block",t.pause(),t.currentTime=0})),demosItems.forEach((e=>{e.addEventListener("mouseenter",(t=>{const a=e.querySelector(".playIocn"),i=e.querySelector("video");clearDemoHoverStyle(),e.classList.add("demoHover");a.onclick=t=>{t.stopPropagation(),videoList.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),i.style.display="block",i.play(),a.style.display="none",e.classList.add("play")},i.addEventListener("ended",(function(){const t=e.querySelector("video"),a=e.querySelector(".playIocn");e.classList.remove("play"),a.style.display="block",t.pause(),t.currentTime=0}))})),e.addEventListener("mouseleave",(t=>{e.classList.remove("demoHover"),demosItems[1].classList.add("demoHover")})),e.addEventListener("click",(t=>{const a=e.querySelector("video"),i=e.querySelector(".playIocn");e.classList.contains("play")?(e.classList.remove("play"),i.style.display="block",a.pause(),a.currentTime=0):(t.stopPropagation(),videoList.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),a.style.display="block",a.play(),i.style.display="none",e.classList.add("play"))}))})),e.addEventListener("click",(t=>{const a=e.querySelector("video"),i=e.querySelector(".playIocn");e.classList.contains("play")?(e.classList.remove("play"),i.style.display="block",a.pause(),a.currentTime=0):(t.stopPropagation(),videoList_m.forEach((e=>{e.pause(),e.currentTime=0,e.parentNode.querySelector(".playIocn").style.display="block"})),a.style.display="block",a.play(),i.style.display="none",e.classList.add("play"))}))}));const seo_animationDemosItemBox_m_swiper=new Swiper(".seo_animationDemosItemBox_m",{initialSlide:1,autoplay:{delay:6e3,disableOnInteraction:!1},speed:800,slidesPerView:1,navigation:{nextEl:".swiper-button-next1",prevEl:".swiper-button-prev1",disabledClass:"disabled"},pagination:{el:".swiper-pagination",clickable:!0}});$(document).ready((function(){genGtag("aidance"),listenPubsub("aidance"),gtag("event","open_aidance_page"),getDanceList(),httpClient.setGlobalHeaders({"X-From-Page":"photo_dance"}),getConfig(),getCreationData(),genAuth.awaitDataInit().then((()=>{initCreditBadge()}))})),$(".micro-test-faq-name").click((function(){$(this).parent(".micro-test-faq-item").hasClass("active")?$(this).parent(".micro-test-faq-item").removeClass("active").find(".micro-test-faq-desc").slideUp(300):$(this).parent(".micro-test-faq-item").addClass("active").find(".micro-test-faq-desc").slideDown(300).end()}));